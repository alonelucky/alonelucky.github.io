{
    "version": "https://jsonfeed.org/version/1",
    "title": "小码农博客 • All posts by \"nats\" tag",
    "description": null,
    "home_page_url": "http://qiubo.ink",
    "items": [
        {
            "id": "http://qiubo.ink/2023/12/29/Nats%E6%9C%8D%E5%8A%A1%E9%83%A8%E7%BD%B2%E8%AE%B0%E5%BD%95/",
            "url": "http://qiubo.ink/2023/12/29/Nats%E6%9C%8D%E5%8A%A1%E9%83%A8%E7%BD%B2%E8%AE%B0%E5%BD%95/",
            "title": "Nats服务部署记录",
            "date_published": "2023-12-29T17:19:02.000Z",
            "content_html": "<p>为了学习和了解 <code>systemctl</code> 采用手动部署 <code>Nats</code>.</p>\n<span id=\"more\"></span>\n\n<h3 id=\"1-Service-配置\"><a href=\"#1-Service-配置\" class=\"headerlink\" title=\"1. Service 配置\"></a>1. Service 配置</h3><figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\"># 在网络启动后启动</span></span><br><span class=\"line\">[Unit]</span><br><span class=\"line\">Description=Nats Server Custom Process</span><br><span class=\"line\">After=network.target</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># 使用完整路径</span></span><br><span class=\"line\">[Service]</span><br><span class=\"line\">ExecStart=pathto/nats-server -l pathto/nats.log -c /etc/nats-server/nats-server.conf -pid pathto/nats-server.pid</span><br><span class=\"line\">ExecStop=/bin/kill $(<span class=\"built_in\">cat</span> pathto/nats-server.pid) <span class=\"comment\"># 找到 pid 终止进程</span></span><br><span class=\"line\">Type=simple</span><br><span class=\"line\">KillMode=process</span><br><span class=\"line\">Restart=on-failure <span class=\"comment\"># 在失败时重启</span></span><br><span class=\"line\">RestartSec=42s</span><br><span class=\"line\"></span><br><span class=\"line\">[Install]</span><br><span class=\"line\">WantedBy=multi-user.target <span class=\"comment\"># 默认开机随用户启动</span></span><br></pre></td></tr></table></figure>\n\n<h3 id=\"2-Nats-配置\"><a href=\"#2-Nats-配置\" class=\"headerlink\" title=\"2. Nats 配置\"></a>2. Nats 配置</h3><figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">http_port: 8222</span><br><span class=\"line\"></span><br><span class=\"line\">jetstream: &#123;</span><br><span class=\"line\">\t# 持久化存储</span><br><span class=\"line\">    store_dir: /usr/local/nats-server-v2.10.7-linux-amd64/data/</span><br><span class=\"line\">\t# 最大内存消息</span><br><span class=\"line\">    max_mem: 128MB</span><br><span class=\"line\">\t# 最大本地存储</span><br><span class=\"line\">    max_file: 1G</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\">authorization: &#123;</span><br><span class=\"line\">    users = [</span><br><span class=\"line\">\t\t&#123;</span><br><span class=\"line\">\t\t\t# 使用 nkey 作为登录</span><br><span class=\"line\">            nkey: UBFE2GTSYNUPELVDQO5N2Q56EMGD7HZ6MGX32XRTK3CWENYK6PM3RW7O</span><br><span class=\"line\">\t\t\t# 拥有全部权限</span><br><span class=\"line\">            permissions: &#123;</span><br><span class=\"line\">                publish: &quot;&gt;&quot;</span><br><span class=\"line\">                subscribe: &quot;&gt;&quot;</span><br><span class=\"line\">            &#125;</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">    ]</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<h3 id=\"3-参考文章\"><a href=\"#3-参考文章\" class=\"headerlink\" title=\"3. 参考文章\"></a>3. 参考文章</h3><ol>\n<li><code>https://yoshiera.gitee.io/posts/nats/nats-keys/</code></li>\n<li><code>https://www.ruanyifeng.com/blog/2016/03/systemd-tutorial-part-two.html</code></li>\n<li><code>https://natsbyexample.com/</code></li>\n</ol>\n",
            "tags": [
                "golang",
                "linux",
                "queue",
                "笔记",
                "nats"
            ]
        }
    ]
}